Order Total Trigger:

trigger OrderTotalTrigger on HandsMen_Order__c (before insert, before update) {
    Set<Id> productIds = new Set<Id>();
 
    for (HandsMen_Order__c order : Trigger.new) {
        if (order.HandsMen_Product__c != null) {
            productIds.add(order.HandsMen_Product__c);
        }
    }
 
    Map<Id, HandsMen_Product__c> productMap = new Map<Id, HandsMen_Product__c>(
        [SELECT Id, Price__c FROM HandsMen_Product__c WHERE Id IN :productIds]
    );
 
    for (HandsMen_Order__c order : Trigger.new) {
        if (order.HandsMen_Product__c != null && productMap.containsKey(order.HandsMen_Product__c)) {
            HandsMen_Product__c product = productMap.get(order.HandsMen_Product__c);
            if (order.Quantity__c != null) {
                order.Total_Amount__c = order.Quantity__c * product.Price__c;
            }
        }
    }
}
 

 

Stock Deduction Trigger:
 

trigger StockDeductionTrigger on HandsMen_Order__c (after insert, after update) {
    Set<Id> productIds = new Set<Id>();
 
    for (HandsMen_Order__c order : Trigger.new) {
        if (order.Status__c == 'Confirmed' && order.HandsMen_Product__c != null) {
            productIds.add(order.HandsMen_Product__c);
        }
    }
 
    if (productIds.isEmpty()) return;
 
    // Query related inventories based on product
    Map<Id, Inventory__c> inventoryMap = new Map<Id, Inventory__c>(
        [SELECT Id, Stock_Quantity__c, HandsMen_Product__c 
         FROM Inventory__c 
         WHERE HandsMen_Product__c IN :productIds]
    );
 
    List<Inventory__c> inventoriesToUpdate = new List<Inventory__c>();
 
    for (HandsMen_Order__c order : Trigger.new) {
        if (order.Status__c == 'Confirmed' && order.HandsMen_Product__c != null) {
            for (Inventory__c inv : inventoryMap.values()) {
                if (inv.HandsMen_Product__c == order.HandsMen_Product__c) {
                    inv.Stock_Quantity__c -= order.Quantity__c;
                    inventoriesToUpdate.add(inv);
                    break;
                }
            }
        }
    }
 
    if (!inventoriesToUpdate.isEmpty()) {
        update inventoriesToUpdate;
    }
}


Purchase Adder:

trigger PurchaseAdder on HandsMen_Order__c (after insert, after update) {
    Set<Id> productIds = new Set<Id>();
    Set<Id> customerIds = new Set<Id>();

    // Collect products and customers from confirmed orders
    for (HandsMen_Order__c order : Trigger.new) {
        if (order.Status__c == 'Confirmed') {
            if (order.HandsMen_Product__c != null) {
                productIds.add(order.HandsMen_Product__c);
            }
            if (order.HandsMen_Customer__c != null) {
                customerIds.add(order.HandsMen_Customer__c);
            }
        }
    }

    // --- Stock deduction ---
    if (!productIds.isEmpty()) {
        Map<Id, Inventory__c> inventoryMap = new Map<Id, Inventory__c>(
            [SELECT Id, Stock_Quantity__c, HandsMen_Product__c 
             FROM Inventory__c 
             WHERE HandsMen_Product__c IN :productIds]
        );

        List<Inventory__c> inventoriesToUpdate = new List<Inventory__c>();

        for (HandsMen_Order__c order : Trigger.new) {
            if (order.Status__c == 'Confirmed' && order.HandsMen_Product__c != null) {
                Inventory__c inv = inventoryMap.get(order.HandsMen_Product__c);
                if (inv != null) {
                    inv.Stock_Quantity__c -= order.Quantity__c;
                    inventoriesToUpdate.add(inv);
                }
            }
        }

        if (!inventoriesToUpdate.isEmpty()) {
            update inventoriesToUpdate;
        }
    }

    // --- Update customer total purchases ---
    if (!customerIds.isEmpty()) {
        // Aggregate total amount per customer
        Map<Id, Decimal> customerTotals = new Map<Id, Decimal>();
        for (HandsMen_Order__c order : Trigger.new) {
            if (order.Status__c == 'Confirmed' && order.HandsMen_Customer__c != null && order.Total_Amount__c != null) {
                if (!customerTotals.containsKey(order.HandsMen_Customer__c)) {
                    customerTotals.put(order.HandsMen_Customer__c, 0);
                }
                customerTotals.put(order.HandsMen_Customer__c, customerTotals.get(order.HandsMen_Customer__c) + order.Total_Amount__c);
            }
        }

        // Query customers
        List<HandsMen_Customer__c> customersToUpdate = [SELECT Id, Total_Purchases__c FROM HandsMen_Customer__c WHERE Id IN :customerIds];
        for (HandsMen_Customer__c cust : customersToUpdate) {
            Decimal addAmount = customerTotals.get(cust.Id);
            cust.Total_Purchases__c = (cust.Total_Purchases__c == null ? 0 : cust.Total_Purchases__c) + addAmount;
        }

        if (!customersToUpdate.isEmpty()) {
            update customersToUpdate;
        }
    }
}
